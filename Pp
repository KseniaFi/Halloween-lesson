from reportlab.pdfgen import canvas
from reportlab.lib.pagesizes import A4
from reportlab.lib.utils import ImageReader
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
import random
import os

# Настройки
PDF_FILENAME = "Matching_Task.pdf"
BACKGROUND_IMAGE = "Photos/IMG_20251020_193039_262.jpg"
PAGE_SIZE = A4
IMAGE_SIZE = 150  # Размер квадратных изображений
FONT_SIZE = 20
TEXT_MARGIN = 20

# Данные для заданий
tasks = [
    ("Photos/IMG_20251020_175109_595.jpg", "Monster"),
    ("Photos/IMG_20251020_123050_219.jpg", "Spider"),
    ("Photos/IMG_20251020_122957_466.jpg", "Mummy"),
    ("Photos/IMG_20251019_161943_247.jpg", "Wizard"),
    ("Photos/IMG_20251019_161657_379.jpg", "Scarecrow"),
    ("Photos/IMG_20251019_161133_941.jpg", "Fireworks"),
    ("Photos/IMG_20251019_161047_687.jpg", "Bat"),
    ("Photos/IMG_20251019_160956_540.jpg", "Vampire"),
    ("Photos/IMG_20251019_160820_005.jpg", "Ghost"),
    ("Photos/IMG_20251019_160644_141.jpg", "Witch"),
    ("Photos/IMG_20251019_160545_015.jpg", "Jack-o'-lantern"),
    ("Photos/IMG_20251020_192659_254.jpg", "Pumpkin")
]

# Перемешиваем слова
words = [task[1] for task in tasks]
random.shuffle(words)

# Создаем PDF
c = canvas.Canvas(PDF_FILENAME, pagesize=PAGE_SIZE)
width, height = PAGE_SIZE

# Добавляем фон
bg = ImageReader(BACKGROUND_IMAGE)
c.drawImage(bg, 0, 0, width=width, height=height)

# Рассчитываем позиции
x_left = width * 0.25 - IMAGE_SIZE/2
x_right = width * 0.75 - IMAGE_SIZE/2
y_start = height * 0.8
y_step = (height * 0.7) / len(tasks)

# Добавляем заголовок
c.setFont("Helvetica-Bold", 24)
c.drawCentredString(width/2, height-100, "Matching Task")

# Добавляем элементы
for i, (img_path, word) in enumerate(tasks):
    y_pos = y_start - i * y_step
    
    # Левая колонка - изображения
    try:
        img = ImageReader(img_path)
        c.drawImage(img, x_left, y_pos-IMAGE_SIZE/2, 
                   width=IMAGE_SIZE, height=IMAGE_SIZE)
    except:
        c.drawString(x_left, y_pos, "[Image Error]")
    
    # Правая колонка - слова
    c.setFont("Helvetica", FONT_SIZE)
    c.drawCentredString(x_right + IMAGE_SIZE/2, y_pos, words[i])

# Добавляем линии для ответов
for i in range(len(tasks)):
    y_pos = y_start - i * y_step
    c.line(x_left + IMAGE_SIZE + 10, y_pos, 
           x_right - 10, y_pos)

c.save()
